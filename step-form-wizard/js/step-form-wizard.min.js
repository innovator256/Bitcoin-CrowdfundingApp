(function(b){function f(a,c){this.config=b.extend({},p,c);this.element=a;this.steps=a.find("fieldset");this.config.showLegend||this.element.addClass("sf-hide-legend");this.btnFinishTmp=this.config.finishBtn;this.btnPrevTmp=this.config.prevBtn;this.btnNextTmp=this.config.nextBtn;this.viewPort;this.navWrap;this.stepOffset=this.config.stepOffset;this.config.startStep>=this.steps.length&&(this.config.startStep=this.steps.length-1);this.stepActive=this.config.startStep;this.init();a.trigger("sf-loaded");
return this}var p={duration:500,timingFunction:"swing",linkNav:!0,showNav:!0,showNavNumbers:!0,showButtons:!0,showLegend:!0,nextBtn:b('<a class="next-btn sf-right sf-btn" href="#">NEXT</a>'),prevBtn:b('<a class="prev-btn sf-left sf-btn" href="#">PREV</a>'),finishBtn:b('<input class="finish-btn sf-right sf-btn" type="submit" value="FINISH"/>'),onNext:function(a,b){},onPrev:function(a,b){},onFinish:function(a,b){},onSlideChanged:function(a,b,d){},startStep:0,stepOffset:10,height:"first",theme:"sea",
markPrevSteps:!1};f.prototype.init=function(){this.element.append(b("<div>").addClass("sf-viewport"));this.viewPort=b(".sf-viewport",this.element);this.element.wrap(b("<div>").addClass("sf-wizard").attr("id",this.element.attr("id")+"-box"));this.wizard=this.element.parent();this.wizard.parent().addClass("sf-"+this.config.theme);this.config.showNavNumbers||this.wizard.addClass("sf-nonumbers");b(this.viewPort).append(b("<div>").addClass("sf-fieldwrap clearfix"));this.fieldWrap=b(".sf-fieldwrap",this.element);
this.element.append(b("<div>").addClass("sf-controls clearfix"));this.controls=b(".sf-controls",this.element);this.config.showButtons||this.controls.addClass("sf-hide-buttons");var a=this;!1!==this.config.showNav&&this.initNav();this.steps.each(function(c){var d=b("<div>").addClass("sf-step sf-step-"+c);c==a.config.startStep?d.addClass("sf-step-active"):d.addClass("sf-step-no-active");b(this).wrap(d).parent().appendTo(a.fieldWrap);b(this).append(b("<div>").addClass("sf-"+c));c==a.config.startStep&&
(a.initBtnFinish(a.config.startStep),a.initBtnNext(a.config.startStep),a.initBtnPrev(a.config.startStep),0==a.config.startStep&&a.element.find(".sf-btn-prev").hide(),a.config.startStep!=a.steps.length-1?a.element.find(".sf-btn-finish").hide():a.element.find(".sf-btn-next").hide())});this.setProportion();b(window).resize(function(){a.careNav(a.stepActive,a.stepActive);a.setProportion()});a.element.on("click",".next-btn",function(c,d){var e=!1;!1!==a.config.onNext(a.stepActive,a.wizard)&&(e=a.goTo(b(".sf-controls .next-btn",
a.element).data("step")));void 0!==d&&(d.ret=e);c.preventDefault()});a.element.on("click",".prev-btn",function(c,d){var e=!1;!1!==a.config.onPrev(a.stepActive,a.wizard)&&(e=a.goTo(b(".sf-controls .prev-btn",a.element).data("step")));void 0!==d&&(d.ret=e);c.preventDefault()});a.element.on("click",".finish-btn",function(b,d){var e=!1,n=jQuery.Event("sf-finish");a.element.trigger(n,[a.stepActive,a.stepActive,a.wizard]);!1===a.config.onFinish(a.stepActive,a.wizard)||n.isDefaultPrevented()?b.preventDefault():
e=!0;void 0!==d&&(d.ret=e)});a.element.on("keydown",":input",function(b){13==(b.keyCode||b.which)&&(a.next(),b.preventDefault())})};f.prototype.initNav=function(){var a=this,c=b("<div>").addClass("sf-nav-wrap clearfix"),d=b("<ul>").addClass("sf-nav clearfix");c.append(d);"bottom"==a.config.showNav?this.element.after(c):this.element.before(c);this.navWrap=b(".sf-nav-wrap",a.wizard);this.steps.each(function(d){var c=b("<li>").addClass("sf-nav-step sf-nav-step-"+d).data("step",d);a.config.markPrevSteps&&
d<a.config.startStep&&c.addClass("sf-nav-prev-step");a.config.showNavNumbers?c.addClass("sf-li-number"):c.addClass("sf-li-nonumber");b("<span>").addClass("sf-nav-subtext").html(b(this).find("legend").first().html()).appendTo(c);var g=b("<div>").addClass("sf-nav-number").appendTo(c);b("<span>").addClass("sf-nav-number-inner").html(d+1).appendTo(g);b("<div>").appendTo(c);d==a.config.startStep&&c.addClass("sf-active");!0==a.config.linkNav&&c.addClass("sf-nav-link");"left"==a.config.showNav&&(b(".sf-nav-wrap",
a.wizard).addClass("sf-nav-left"),a.element.addClass("sf-nav-on-left"));"right"==a.config.showNav&&(b(".sf-nav-wrap",a.wizard).addClass("sf-nav-right"),a.element.addClass("sf-nav-on-right"));if("top"==a.config.showNav||!0===a.config.showNav)b(".sf-nav-wrap",a.wizard).addClass("sf-nav-top"),a.element.addClass("sf-nav-on-top");"bottom"==a.config.showNav&&(b(".sf-nav-wrap",a.wizard).addClass("sf-nav-bottom"),a.element.addClass("sf-nav-on-bottom"));a.wizard.find(".sf-nav").append(c)});b(".sf-nav-step.sf-nav-link",
a.wizard).on("click",function(d){var c=b(this).data("step"),g=a.stepActive;if(0>a.stepActive-c)for(var h=a.stepActive;h<c;h++)if(!1!==a.config.onNext(h))g=h+1;else break;else for(h=a.stepActive;h>c;h--)if(!1!==a.config.onPrev(h))g=h-1;else break;a.goTo(g);d.preventDefault()});this.careNav(this.stepActive,this.stepActive)};f.prototype.setProportion=function(){this.stepWidth=this.viewPort.width();var a=this.stepWidth*this.steps.length,c=0;if("auto"==this.config.height&&this.steps.length){this.viewPort.height("auto");
var d=b(this.steps[this.stepActive]).outerHeight(!0);this.viewPort.height(d)}"first"==this.config.height&&this.steps.length&&(b(this.steps[0]).height("auto"),c=b(this.steps[0]).height());!isNaN(parseInt(this.config.height))&&this.steps.length&&(c=this.config.height);"tallest"==this.config.height&&this.steps.length&&this.steps.each(function(a){b(this).height("auto");b(this).height()>c&&(c=b(this).height())});var e=this;this.steps.each(function(a){b(this).parent().css({width:e.stepWidth+"px","float":"left",
"margin-right":e.stepOffset+"px"});c&&b(this).height(c)});this.fieldWrap.width(a+this.stepOffset*this.steps.length+"px");this.fieldWrap.css({"margin-left":"-"+(this.stepActive*this.stepWidth+this.stepOffset*this.stepActive)+"px"})};f.prototype.goTo=function(a){var c=this,d=this.stepActive,e=d-a,f=jQuery.Event("sf-step-before");c.element.trigger(f,[d,a,c.wizard]);if(f.isDefaultPrevented())return!1;c.config.markPrevSteps&&b(".sf-nav-step",c.navWrap).each(function(c){b(this).removeClass("sf-nav-prev-step");
c<a&&b(this).addClass("sf-nav-prev-step")});this.careNav(a,d);c.element.find(".sf-step").removeClass("sf-step-no-active").addClass("sf-step-active");f="+=";0>e&&(f="-=");e=Math.abs(e);this.fieldWrap.animate({"margin-left":f+(e*this.stepWidth+this.stepOffset*e)},this.config.duration*e,this.config.timingFunction,function(){c.element.find(".sf-step").removeClass("sf-step-active").addClass("sf-step-no-active");c.element.find(".sf-step-"+a).removeClass("sf-step-no-active").addClass("sf-step-active");c.element.trigger("sf-step-after",
[d,a,c.wizard]);c.config.onSlideChanged(d,a,this.wizard)});this.stepActive=a;b(".sf-nav-step",this.wizard).removeClass("sf-active");b(".sf-nav-step-"+a,this.wizard).addClass("sf-active");"auto"==this.config.height&&this.steps.length&&(e=b(this.steps[this.stepActive]).outerHeight(!0),this.viewPort.animate({height:e+"px"},this.config.duration,this.config.timingFunction));a+1<this.steps.length?this.btnNext.data("step",a+1).fadeIn(100):this.btnNext.fadeOut(0);a+1>=this.steps.length?this.btnFinish.data("step",
a-1).fadeIn(100):this.btnFinish.fadeOut(0);0==a?this.btnPrev.fadeOut(100):this.btnPrev.data("step",a-1).fadeIn(100);return!0};f.prototype.careNav=function(a,c){var d=this;if(!1!==d.config.showNav){var e=d.navWrap.width(),f=[];if(d.navWrap.hasClass("sf-nav-top")||d.navWrap.hasClass("sf-nav-bottom")){var g=0,h=0;b(".sf-nav-step",d.navWrap).each(function(c){f[c]=b(this).outerWidth(!0);h+=f[c];c<a&&(g+=f[c])});0<=c-a&&(g-=f[a-1]);if(h>e){var e=h-e,l=a-1,m=0;0>c-a&&(l=a+1,m=-50);g>e&&(g=e,m=0);b(".sf-nav-step-"+
l,this.wizard).length?b(".sf-nav",d.navWrap).animate({left:"-"+(g+m)+"px"},this.config.duration):0>l?b(".sf-nav",d.navWrap).animate({left:"0px"},this.config.duration):b(".sf-nav",d.navWrap).animate({left:"-"+g+"px"},this.config.duration)}}else{var k=0;b(".sf-nav-step",d.navWrap).each(function(a){d.navWrap.css("width","9999px");a=b(this).css("float","left").outerWidth(!0);d.navWrap.css("width","");b(this).css("float","");k<a&&(k=a)});k+=2;e=d.element.closest(".sf-wizard").width()-k;d.element.css({width:e+
"px","float":""});d.navWrap.hasClass("sf-nav-left")&&d.element.css({"margin-left":k+"px"});d.navWrap.css("width",k+"px")}}};f.prototype.refresh=function(){this.careNav(this.stepActive,this.stepActive);this.setProportion()};f.prototype.initBtnNext=function(a){this.btnNext=this.btnNextTmp.clone(!0).addClass("sf-btn-next").data("step",a+1);this.btnNext.appendTo(b(this.controls))};f.prototype.initBtnPrev=function(a){this.btnPrev=this.btnPrevTmp.clone(!0).addClass("sf-btn-prev").data("step",a-1);this.btnPrev.appendTo(b(this.controls))};
f.prototype.initBtnFinish=function(a){b(".sf-step-"+a).append(" ");this.btnFinish=this.btnFinishTmp.clone(!0).addClass("sf-btn-finish").data("step",a-1);this.btnFinish.appendTo(b(this.controls))};f.prototype.next=function(){var a={ret:!1};this.stepActive<this.steps.length-1?b(".sf-controls .next-btn",this.element).trigger("click",[a]):b(".sf-controls .finish-btn",this.element).trigger("click",[a]);return a.ret};f.prototype.prev=function(){var a={ret:!1};b(".sf-controls .prev-btn",this.element).trigger("click",
[a]);return a.ret};f.prototype.finish=function(){var a={ret:!1};b(".sf-controls .finish-btn",this.element).trigger("click",[a]);return a.ret};b.fn.stepFormWizard=function(a){return new f(this.first(),a)}})(jQuery);
